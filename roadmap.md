# **План реализации продукта «Генератор меню Trimspire»**

Этот документ описывает пошаговый план создания и запуска продукта для генерации персонализированных планов питания, который является продолжением существующей воронки-анкеты «Trimspire».

## **Фаза 1: Фундамент и Бэкенд (Сердце продукта)**

На этом этапе мы создадим серверную часть, которая будет хранить данные и выполнять всю сложную логику.

### **Шаг 1: Проектирование базы данных и выбор стека**

* **Технологии:**
    * **Бэкенд:** **Next.js API Routes**. Это позволит держать воронку и продукт в одном репозитории.
    * **База данных (БД):** **PostgreSQL**. Надежная и масштабируемая реляционная БД.
    * **ORM (Связь с БД):** **Prisma**. Современный, безопасный и удобный инструмент для работы с базой данных в TypeScript-проектах.

* **Структура БД (Схема Prisma):**
    * **`User`**: Таблица пользователей.
        * Поля: `id`, `email`, `createdAt`.
    * **`QuizAnswers`**: Таблица для ответов из анкеты.
        * Поля: `id`, `userId` (связь с `User`), `goal`, `bodyType`, `struggles` (массив), `allergies` (массив) и т.д. — по одному полю на каждый значимый вопрос.
    * **`Subscription`**: Таблица для отслеживания оплат.
        * Поля: `id`, `userId`, `status` (`active`, `expired`), `expiresAt`.
    * **`Recipe`**: Основная таблица рецептов.
        * Поля: `id`, `title`, `description`, `instructions`, `imageUrl`, `calories`, `proteins`, `fats`, `carbs`, `cookingTime`.
    * **`Ingredient`**: Справочник всех ингредиентов.
        * Поля: `id`, `name`, `category` (например, "овощи", "мясо").
    * **`RecipeIngredient`**: Связующая таблица между рецептами и ингредиентами.
        * Поля: `recipeId`, `ingredientId`, `quantity`, `unit` (например, "гр.", "шт.").
    * **`Tag`**: Справочник тегов для рецептов.
        * Поля: `id`, `name` (например, "низкоуглеводный", "вегетарианский").
    * **`RecipeTag`**: Связующая таблица между рецептами и тегами.

### **Шаг 2: Разработка API (Каналы связи)**

Создадим API-эндпоинты в `src/pages/api/`:
* `/api/auth/login`: Для входа пользователя по "магической ссылке" на email.
* `/api/quiz/save`: Для сохранения ответов анкеты и создания пользователя.
* `/api/payment/webhook`: Для приема уведомлений от платежной системы об успешной оплате.
* `/api/menu/generate`: **Ключевой эндпоинт.** Генерирует и возвращает план питания на неделю на основе ответов пользователя.
* `/api/menu/regenerate-meal`: Позволяет заменить одно блюдо в сгенерированном плане.
* `/api/shopping-list`: Формирует и возвращает список покупок на неделю.

---

## **Фаза 2: Фронтенд (То, что увидит пользователь)**

Создадим пользовательский интерфейс для взаимодействия с продуктом после оплаты.

### **Шаг 3: Аутентификация и доступ**

* Создадим страницу входа, куда пользователь попадает по ссылке из письма после оплаты.
* Реализуем логику "защищенных страниц": доступ к генератору меню будет только у авторизованных пользователей с активной подпиской.

### **Шаг 4: Главный экран — План питания**

* Разработаем интерфейс для отображения сгенерированного плана питания на неделю (например, в виде сетки или колонок по дням).
* Каждое блюдо будет представлено в виде карточки с названием, фото и основными КБЖУ.

### **Шаг 5: Детальный просмотр рецепта**

* Реализуем модальное окно или отдельную страницу, которая открывается по клику на блюдо.
* На этой странице будет полная информация: фото, список ингредиентов, пошаговая инструкция, полное КБЖУ.

### **Шаг 6: Интерактивные функции**

* **Замена блюда:** На каждой карточке блюда добавим кнопку "заменить", которая будет вызывать соответствующий API-эндпоинт и обновлять интерфейс.
* **Список покупок:** На главном экране разместим кнопку "Список покупок", которая будет генерировать и отображать сгруппированный по категориям список всех необходимых ингредиентов.

---

## **Фаза 3: Безопасность и запуск**

Финальный этап, на котором мы убедимся в надежности продукта и подготовим его к запуску.

### **Шаг 7: Наполнение базы данных**

* Подготовим и загрузим в базу данных первоначальный набор рецептов, ингредиентов и тегов. Важно правильно проставить теги в соответствии с вариантами ответов в анкете.

### **Шаг 8: Безопасность**

* **Защита API:** Все эндпоинты, кроме публичных (`/login`, `/webhook`), должны требовать аутентификации пользователя.
* **Валидация данных:** Настроим проверку всех входящих данных на сервере для предотвращения атак.
* **Переменные окружения:** Все "секреты" (ключи от БД, API, платежной системы) будем хранить в `.env` файлах.

### **Шаг 9: Развертывание (Деплой)**

* Развернем приложение на хостинге, который хорошо подходит для Next.js (например, Vercel).
* Базу данных PostgreSQL разместим на надежном облачном сервисе (например, Supabase, Neon, Railway).
* Проведем финальное сквозное тестирование всего пользовательского пути.